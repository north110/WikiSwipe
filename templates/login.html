<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Login / Signup</title>
  </head>
  <body>
    <h1>Login</h1>
    <form id="loginForm">
      <input type="text" id="loginUsername" placeholder="Username" required />
      <input type="password" id="loginPassword" placeholder="Password" required />
      <button type="submit">Login</button>
    </form>

    <h1>Signup</h1>
    <form id="signupForm">
      <input type="text" id="signupUsername" placeholder="Username" required />
      <input type="email" id="signupEmail" placeholder="Email" required />
      <input type="password" id="signupPassword" placeholder="Password" required />
      <button type="submit">Signup</button>
    </form>

    <script>
      // Handle login form submission
      document.getElementById("loginForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const username = document.getElementById("loginUsername").value;
        const password = document.getElementById("loginPassword").value;
        
        const formData = new URLSearchParams();
        formData.append("username", username);
        formData.append("password", password);
  
        const response = await fetch("http://localhost:8000/login", {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded"
          },
          body: formData.toString(),
        });
  
        if (response.ok) {
          const data = await response.json();
          localStorage.setItem("access_token", data.access_token);
          window.location.href = "/"; // Redirect to the protected page
        } else {
          alert("Login failed");
        }
      });
  
      // Handle signup form submission
      document.getElementById("signupForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const username = document.getElementById("signupUsername").value;
        const email = document.getElementById("signupEmail").value;
        const password = document.getElementById("signupPassword").value;
  
        const response = await fetch("http://localhost:8000/signup", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ username, email, password })
        });
  
        if (response.ok) {
          alert("Signup successful, please login.");
        } else {
          alert("Signup failed");
        }
      });
    </script>
  </body>
</html>